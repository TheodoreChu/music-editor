{"version":3,"sources":["components/MusicEditor.tsx","reportWebVitals.ts","index.tsx"],"names":["ComponentDataKey","HtmlElementId","HtmlClassName","ModeType","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","MouseEvent","modes","type","Edit","label","css","Split","View","debugMode","initialState","mode","success","text","keyMap","Map","MusicEditor","props","editorKit","note","componentDidMount","configureEditorKit","configureResizer","delegate","EditorKitDelegate","setEditorRawText","setState","state","renderMusic","loadSavedMode","clearUndoHistory","getElementsBySelector","EditorKit","supportsFilesafe","saveNote","onEditorValueChanged","handleInputChange","event","value","target","view","document","getElementById","innerHTML","Renderer","Vex","Flow","renderer","Backends","SVG","artist","Artist","scale","tab","VexTab","parse","render","e","savedMode","internal","componentManager","componentDataValueForKey","Mode","setModeFromModeType","platform","logDebugMessage","changeMode","setComponentDataValueForKey","removeSelection","selection","window","getSelection","removeAllRanges","editor","Editor","columnResizer","ColumnResizer","pressed","resizerWidth","offsetWidth","addEventListener","Down","classList","add","Dragging","NoSelection","Move","x","clientX","colLeft","style","left","width","Up","remove","onBlur","clear","onFocus","onKeyDown","set","key","get","preventDefault","execCommand","onKeyUp","delete","message","object","print","className","this","id","tabIndex","Header","map","onClick","PrintButton","EditorContainer","autoCapitalize","autoComplete","dir","onChange","spellCheck","React","Component","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.ebe86da9.chunk.js","sourcesContent":["import React from 'react';\nimport { EditorKit, EditorKitDelegate } from 'sn-editor-kit';\nimport { Vex, VexTab, Artist } from 'vextab';\n\nenum ComponentDataKey {\n  Mode = 'mode',\n}\n\nenum HtmlElementId {\n  ColumnResizer = 'column-resizer',\n  Editor = 'editor',\n  EditorContainer = 'editor-container',\n  Header = 'header',\n  MusicEditor = 'music-editor',\n  View = 'view',\n  PrintButton = 'print-button',\n}\n\nenum HtmlClassName {\n  Dragging = 'dragging',\n  NoSelection = 'no-selection',\n}\n\ntype Mode = {\n  type: ModeType;\n  label: string;\n  css: string;\n};\n\nenum ModeType {\n  Edit = 0,\n  Split = 1,\n  View = 2,\n}\n\nconst modes = [\n  { type: ModeType.Edit, label: 'Edit', css: 'edit' } as Mode,\n  { type: ModeType.Split, label: 'Split', css: 'split' } as Mode,\n  { type: ModeType.View, label: 'View', css: 'view' } as Mode,\n];\n\nenum MouseEvent {\n  Down = 'mousedown',\n  Move = 'mousemove',\n  Up = 'mouseup',\n}\n\ntype MusicEditorState = {\n  text: string;\n  mode: Mode;\n  platform?: string;\n  success: boolean;\n};\n\nconst debugMode = false;\n\nconst initialState = {\n  mode: modes[1],\n  success: false,\n  text: 'options scale=1.0\\n\\ntabstave notation=true tablature=false\\nnotes ',\n};\n\nconst keyMap = new Map();\n\nexport default class MusicEditor extends React.Component<{}, MusicEditorState> {\n  editorKit: any;\n  note: any;\n\n  constructor(props: any) {\n    super(props);\n    this.state = initialState;\n  }\n\n  componentDidMount = () => {\n    this.configureEditorKit();\n    this.configureResizer();\n  };\n\n  configureEditorKit = () => {\n    const delegate = new EditorKitDelegate({\n      setEditorRawText: (text: string) => {\n        this.setState(\n          {\n            text,\n          },\n          () => {\n            if (!this.state.text) {\n              this.setState({\n                text: initialState.text,\n              });\n            }\n            this.renderMusic();\n            this.loadSavedMode();\n          }\n        );\n      },\n      clearUndoHistory: () => {},\n      getElementsBySelector: () => [],\n    });\n\n    this.editorKit = new EditorKit({\n      delegate: delegate,\n      mode: 'plaintext',\n      supportsFilesafe: false,\n    });\n  };\n\n  saveNote = () => {\n    this.editorKit.onEditorValueChanged(this.state.text);\n  };\n\n  handleInputChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const target = event.target;\n    const value = target.value;\n\n    this.setState(\n      {\n        text: value,\n      },\n      () => {\n        this.saveNote();\n        // Do not re-render music in edit-only mode\n        if (this.state.mode !== modes[0]) {\n          this.renderMusic();\n        }\n      }\n    );\n  };\n\n  renderMusic = () => {\n    const view = document.getElementById(HtmlElementId.View);\n    if (view) {\n      view.innerHTML = '';\n    }\n    // Create VexFlow Renderer from canvas element with id #view\n    const Renderer = Vex.Flow.Renderer;\n    const renderer = new Renderer(view, Renderer.Backends.SVG);\n\n    // Initialize VexTab artist and parser.\n    const artist = new Artist(10, 10, 600, { scale: 0.8 });\n    const tab = new VexTab(artist);\n    try {\n      tab.parse(this.state.text);\n      artist.render(renderer);\n      if (!this.state.success) {\n        this.setState({\n          success: true,\n        });\n      }\n    } catch (e) {\n      this.setState(\n        {\n          success: false,\n        },\n        () => {\n          if (view) {\n            const helpMessage = `<br/><br/><hr/><br/>Need help? Check out the <a href=\"https://vexflow.com/vextab/tutorial.html\" target=\"_blank\" rel=\"nofollow noreferrer noopener\">VexTab Tutorial</a>.`;\n            view.innerHTML = e + helpMessage;\n          }\n          if (debugMode) {\n            console.log(e);\n          }\n        }\n      );\n    }\n  };\n\n  loadSavedMode = () => {\n    try {\n      const savedMode = this.editorKit.internal.componentManager.componentDataValueForKey(\n        ComponentDataKey.Mode\n      ) as ModeType;\n      if (debugMode) {\n        console.log('loaded savedMode: ' + savedMode);\n      }\n      // We can't use if(savedMode) because it would return false for 0\n      if (typeof savedMode === 'number') {\n        this.setModeFromModeType(savedMode);\n      }\n      this.setState(\n        {\n          platform: this.editorKit.internal.componentManager.platform,\n        },\n        () => {\n          if (debugMode) {\n            console.log(this.state.platform);\n          }\n        }\n      );\n    } catch (e) {\n      if (debugMode) {\n        console.log('Error when loading saved mode: ' + e);\n      }\n    }\n  };\n\n  setModeFromModeType = (value: ModeType) => {\n    for (const mode of modes) {\n      if (mode.type === value) {\n        this.logDebugMessage('setModeFromModeType mode: ', mode.type);\n        this.setState(\n          {\n            mode,\n          },\n          () => {\n            this.renderMusic();\n          }\n        );\n        return;\n      }\n    }\n  };\n\n  changeMode = (mode: Mode) => {\n    this.setState(\n      {\n        mode,\n      },\n      () => {\n        this.renderMusic();\n      }\n    );\n    this.logDebugMessage('changeMode mode: ', mode.type);\n    try {\n      this.editorKit.internal.componentManager.setComponentDataValueForKey(\n        ComponentDataKey.Mode,\n        mode.type\n      );\n    } catch (e) {\n      if (debugMode) {\n        console.log('Error saving mode: ' + e);\n      }\n    }\n  };\n\n  removeSelection = () => {\n    let selection = window.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n    }\n  };\n\n  configureResizer = () => {\n    const MusicEditor = document.getElementById(HtmlElementId.MusicEditor);\n    const editor = document.getElementById(HtmlElementId.Editor);\n    const columnResizer = document.getElementById(HtmlElementId.ColumnResizer);\n    let pressed = false;\n    let safetyOffset = 15;\n    let resizerWidth = 0;\n    if (columnResizer) {\n      resizerWidth = columnResizer.offsetWidth;\n    }\n\n    if (editor && columnResizer) {\n      columnResizer.addEventListener(MouseEvent.Down, (event) => {\n        pressed = true;\n        columnResizer.classList.add(HtmlClassName.Dragging);\n        editor.classList.add(HtmlClassName.NoSelection);\n      });\n    }\n\n    document.addEventListener(MouseEvent.Move, (event) => {\n      if (!pressed) {\n        return;\n      }\n      let x = event.clientX;\n      if (MusicEditor) {\n        if (x < resizerWidth / 2 + safetyOffset) {\n          x = resizerWidth / 2 + safetyOffset;\n        } else if (x > MusicEditor.offsetWidth - resizerWidth - safetyOffset) {\n          x = MusicEditor.offsetWidth - resizerWidth - safetyOffset;\n        }\n      }\n\n      const colLeft = x - resizerWidth / 2;\n      if (columnResizer) {\n        columnResizer.style.left = colLeft + 'px';\n      }\n      if (editor) {\n        editor.style.width = colLeft - safetyOffset + 'px';\n      }\n\n      this.removeSelection();\n    });\n\n    document.addEventListener(MouseEvent.Up, (event) => {\n      if (pressed) {\n        pressed = false;\n        if (columnResizer) {\n          columnResizer.classList.remove(HtmlClassName.Dragging);\n        }\n        if (editor) {\n          editor.classList.remove(HtmlClassName.NoSelection);\n        }\n      }\n    });\n  };\n\n  onBlur = () => {\n    keyMap.clear();\n  };\n\n  onFocus = (e: React.FocusEvent) => {};\n\n  onKeyDown = (event: React.KeyboardEvent) => {\n    keyMap.set(event.key, true);\n    if (!keyMap.get('Shift') && keyMap.get('Tab')) {\n      event.preventDefault();\n      document.execCommand('insertText', false, '\\t');\n    } else if (keyMap.get('Control') && keyMap.get('s')) {\n      event.preventDefault();\n    }\n  };\n\n  onKeyUp = (event: React.KeyboardEvent) => {\n    keyMap.delete(event.key);\n  };\n\n  logDebugMessage = (message: string, object: any) => {\n    if (debugMode) {\n      console.log(message, object);\n    }\n  };\n\n  print = () => {\n    this.renderMusic();\n    window.print();\n  };\n\n  render() {\n    return (\n      <div\n        className={'sn-component ' + this.state.platform}\n        id={HtmlElementId.MusicEditor}\n        tabIndex={0}\n      >\n        <div id={HtmlElementId.Header}>\n          <div className=\"segmented-buttons-container sk-segmented-buttons\">\n            <div className=\"buttons\">\n              {modes.map((mode) => (\n                <button\n                  onClick={() => this.changeMode(mode)}\n                  className={\n                    'sk-button button ' +\n                    (this.state.mode === mode\n                      ? 'selected info'\n                      : 'sk-secondary-contrast')\n                  }\n                >\n                  <div className=\"sk-label\">{mode.label}</div>\n                </button>\n              ))}\n            </div>\n          </div>\n          <button\n            className={'sk-button button sk-secondary-contrast'}\n            id={HtmlElementId.PrintButton}\n            onClick={() => this.print()}\n          >\n            <div className=\"sk-label\">{'Print'}</div>\n          </button>\n        </div>\n        <main\n          id={HtmlElementId.EditorContainer}\n          className={this.state.mode.css}\n        >\n          <textarea\n            autoCapitalize=\"false\"\n            autoComplete=\"false\"\n            className={this.state.mode.css}\n            dir=\"auto\"\n            id={HtmlElementId.Editor}\n            onBlur={this.onBlur}\n            onChange={this.handleInputChange}\n            onKeyDown={this.onKeyDown}\n            onKeyUp={this.onKeyUp}\n            spellCheck=\"false\"\n            value={this.state.text}\n          />\n          <div\n            className={this.state.mode.css}\n            id={HtmlElementId.ColumnResizer}\n          ></div>\n          <section\n            className={\n              this.state.mode.css + (this.state.success ? ' success' : '')\n            }\n            id={HtmlElementId.View}\n            tabIndex={0}\n          ></section>\n        </main>\n      </div>\n    );\n  }\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport reportWebVitals from './reportWebVitals';\n\nimport MusicEditor from './components/MusicEditor';\nimport './stylesheets/main.scss';\n\nReactDOM.render(\n  <React.StrictMode>\n    <MusicEditor />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}